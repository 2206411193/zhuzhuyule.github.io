"use strict";var canvas,ctx,pixelRadius,pixelContiner,fontSize=500,fontFamily="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif",shapeShift={init:function(){var t=window.location.href,e=t.indexOf("?a=");shapeShift.Drawing.init(".canvas"),shapeShift.ShapeBuilder.init(),shapeShift.UI.init(),-1!==e?shapeShift.UI.simulate(decodeURI(t).substring(e+3)):shapeShift.UI.simulate("#rectangle 5x5|#circle 25|Shape|Shifter|Type|to start|#icon thumbs-up|#countdown 3||"),shapeShift.Drawing.loop(function(){shapeShift.Shape.render()})}};window.addEventListener("load",function(){(canvas=document.createElement("canvas")).id="mainCanvas",canvas.className="canvas",canvas.height=600,canvas.width=600,ctx=canvas.getContext("2d"),pixelContiner=2*(pixelRadius=3)+1,document.body.insertBefore(canvas,document.body.firstChild),document.body.classList.add("body--ready"),shapeShift.init()}),shapeShift.Drawing=function(){var t,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};return{init:function(t){this.adjustCanvas(),window.addEventListener("resize",function(){shapeShift.Drawing.adjustCanvas()})},loop:function(i){t=t||i,this.clearFrame(),t(),e.call(window,this.loop.bind(this))},adjustCanvas:function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight},clearFrame:function(){ctx.clearRect(0,0,canvas.width,canvas.height)},getArea:function(){return{w:canvas.width,h:canvas.height}},drawCircle:function(t,e){ctx.fillStyle=e.render(),ctx.beginPath(),ctx.arc(t.x,t.y,t.r,0,2*Math.PI,!0),ctx.closePath(),ctx.fill()}}}(),shapeShift.Point=function(t){this.x=t.x,this.y=t.y,this.r=t.r,this.a=t.a,this.h=t.h},shapeShift.Color=function(t,e,i,a){this.r=t,this.g=e,this.b=i,this.a=a},shapeShift.Color.prototype={render:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"}},shapeShift.UI=function(){function t(t){var e=t.getHours(),i=t.getMinutes();return i=i<10?"0"+i:i,e+":"+i}function e(t,e,i,a){clearInterval(s),t(h=a?i:1),(!i||!a&&h<i||a&&h>0)&&(s=setInterval(function(){t(h=a?h-1:h+1),(!a&&i&&h===i||a&&0===h)&&clearInterval(s)},e))}function i(t){clearInterval(s),w=[],o=null,t&&shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.letter(""))}function a(i){var s,h;p.classList.remove("overlay--visible"),w="object"==typeof i?i:w.concat(i.split("|")),c.value="",n(),e(function(){switch(h=w.shift(),s=function(t){return(t=t&&t.split(" ")[0])&&t[0]===m&&t.substring(1)}(h),i=function(t){return t&&t.split(" ")[1]}(h),s){case"countdown":i=parseInt(i,10)||10,e(function(t){0===t?0===w.length?shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.letter("")):a(w):shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.letter(t),!0)},1e3,i=i>0?i:10,!0);break;case"rectangle":i=i&&i.split("x"),i=i&&2===i.length?i:[v,v/2],shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.rectangle(Math.min(v,parseInt(i[0],10)),Math.min(v,parseInt(i[1],10))));break;case"circle":i=parseInt(i,10)||v,i=Math.min(i,v),shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.circle(i));break;case"time":var n=t(new Date);w.length>0?shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.letter(n)):e(function(){(n=t(new Date))!==o&&(o=n,shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.letter(o)))},1e3);break;case"icon":shapeShift.ShapeBuilder.imageFile("font-awesome/"+i+".png",function(t){shapeShift.Shape.switchShape(t)});break;default:shapeShift.Shape.switchShape(shapeShift.ShapeBuilder.letter(h[0]===m?"What?":h))}},2e3,w.length)}function n(){c.value.length>18?l.classList.add("ui--wide"):l.classList.remove("ui--wide"),S&&c.value.length>0?l.classList.add("ui--enter"):l.classList.remove("ui--enter")}var s,h,r,o,c=document.querySelector(".ui-input"),l=document.querySelector(".ui"),d=document.querySelector(".help"),u=document.querySelector(".commands"),p=document.querySelector(".overlay"),f=!1,v=30,S=!0,w=[],m="#";return{init:function(){document.body.addEventListener("keydown",function(t){c.focus(),13===t.keyCode&&(S=!1,i(),a(c.value))}),window.addEventListener("resize",function(){clearTimeout(r),r=setTimeout(function(){shapeShift.Shape.shuffleIdle(),i(!0)},500)}),c.addEventListener("input",n),c.addEventListener("change",n),c.addEventListener("focus",n),d.addEventListener("click",function(){p.classList.toggle("overlay--visible"),p.classList.contains("overlay--visible")&&i(!0)}),u.addEventListener("click",function(t){var e,n,s,h;n=(e=t.target.classList.contains("commands-item")?t.target:t.target.parentNode.classList.contains("commands-item")?t.target.parentNode:t.target.parentNode.parentNode)&&e.querySelector(".commands-item-info"),s=e&&n.getAttribute("data-demo"),h=e&&n.getAttribute("data-url"),n&&(p.classList.remove("overlay--visible"),s?(c.value=s,f?(i(),a(c.value)):c.focus()):h&&(window.location=h))}),canvas.addEventListener("click",function(){p.classList.remove("overlay--visible")}),c.focus(),f&&document.body.classList.add("touch"),shapeShift.UI.Tabs.init()},simulate:function(t){a(t)}}}(),shapeShift.UI.Tabs=function(){function t(t){i[t].classList.add("tabs-label--active"),a[t].classList.add("tabs-panel--active")}var e=document.querySelector(".tabs-labels"),i=document.querySelectorAll(".tabs-label"),a=document.querySelectorAll(".tabs-panel");return{init:function(){t(0),e.addEventListener("click",function(e){var n,s=e.target;if(s.classList.contains("tabs-label")){for(var h=0;h<i.length;h++)i[h].classList.remove("tabs-label--active"),a[h].classList.remove("tabs-panel--active"),s===i[h]&&(n=h);t(n)}})}}}(),shapeShift.Dot=function(t,e){this.p=new shapeShift.Point({x:t,y:e,r:pixelRadius,a:1,h:0}),this.e=.07,this.s=!0,this.c=new shapeShift.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},shapeShift.Dot.prototype={clone:function(){return new shapeShift.Point({x:this.x,y:this.y,r:this.r,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,shapeShift.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var e=this.distanceTo(t,!0),i=e[0],a=e[1],n=e[2],s=this.e*n;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(n>1)this.p.x-=i/n*s,this.p.y-=a/n*s;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){var t,e;this._moveTowards(this.t)&&((t=this.q.shift())?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.r=t.r||this.p.r,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new shapeShift.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))),e=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*e),e=this.p.r-this.t.r,this.p.r=Math.max(1,this.p.r-.05*e)},distanceTo:function(t,e){var i=this.p.x-t.x,a=this.p.y-t.y,n=Math.sqrt(i*i+a*a);return e?[i,a,n]:n},move:function(t,e){(!e||e&&this.distanceTo(t)>1)&&this.q.push(t)},render:function(){this._update(),this._draw()}},shapeShift.ShapeBuilder=function(){function t(){canvas.width=Math.floor(window.innerWidth/pixelContiner)*pixelContiner,canvas.height=Math.floor(window.innerHeight/pixelContiner)*pixelContiner,ctx.fillStyle="red",ctx.textBaseline="middle",ctx.textAlign="center"}function e(){for(var t=ctx.getImageData(0,0,canvas.width,canvas.height).data,e=[],i=0,a=0,n=canvas.width,s=canvas.height,h=0,r=0,o=0;o<t.length;o+=4*pixelContiner)t[o+3]>0&&(e.push(new shapeShift.Point({x:i,y:a})),h=i>h?i:h,r=a>r?a:r,n=i<n?i:n,s=a<s?a:s),(i+=pixelContiner)>=canvas.width&&(i=0,a+=pixelContiner,o+=4*pixelContiner*canvas.width);return{dots:e,w:h+n,h:r+s}}function i(t){ctx.font="bold "+t+"px "+fontFamily}return{init:function(){t(),window.addEventListener("resize",t)},imageFile:function(t,i){var a=new Image,n=shapeShift.Drawing.getArea();a.onload=function(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(this,0,0,.6*n.h,.6*n.h),i(e())},a.onerror=function(){i(shapeShift.ShapeBuilder.letter("What?"))},a.src=t},circle:function(t){var i=Math.max(0,t)/2;return ctx.clearRect(0,0,canvas.width,canvas.height),ctx.beginPath(),ctx.arc(i*pixelContiner,i*pixelContiner,i*pixelContiner,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),e()},letter:function(t){var a=0;return i(fontSize),a=Math.min(fontSize,canvas.width/ctx.measureText(t).width*.8*fontSize,canvas.height/fontSize*(function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(t)?1:.45)*fontSize),i(a),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillText(t,canvas.width/2,canvas.height/2),e()},rectangle:function(t,e){for(var i=[],a=pixelContiner*t,n=pixelContiner*e,s=0;s<n;s+=pixelContiner)for(var h=0;h<a;h+=pixelContiner)i.push(new shapeShift.Point({x:h,y:s}));return{dots:i,w:a,h:n}}}}(),shapeShift.Shape=function(){var t=[],e=0,i=0,a=0,n=0;return{shuffleIdle:function(){for(var e=shapeShift.Drawing.getArea(),i=0;i<t.length;i++)t[i].s||t[i].move({x:Math.random()*e.w,y:Math.random()*e.h})},switchShape:function(s,h){var r,o=shapeShift.Drawing.getArea(),c=0,l=0;if(e=s.w,i=s.h,function(){var t=shapeShift.Drawing.getArea();a=t.w/2-e/2,n=t.h/2-i/2}(),s.dots.length>t.length)for(r=s.dots.length-t.length,c=1;c<=r;c++)t.push(new shapeShift.Dot(o.w/2,o.h/2));for(c=0;s.dots.length>0;)l=Math.floor(Math.random()*s.dots.length),t[c].e=h?.25:t[c].s?.14:.11,t[c].s?t[c].move(new shapeShift.Point({r:20*Math.random()+10,a:Math.random(),h:18})):t[c].move(new shapeShift.Point({r:Math.random()*pixelRadius+pixelRadius,h:h?18:30})),t[c].s=!0,t[c].move(new shapeShift.Point({x:s.dots[l].x+a,y:s.dots[l].y+n,a:1,r:pixelRadius,h:0})),s.dots=s.dots.slice(0,l).concat(s.dots.slice(l+1)),c++;for(l=c;l<t.length;l++)t[l].s&&(t[l].move(new shapeShift.Point({r:20*Math.random()+10,a:Math.random(),h:20})),t[l].s=!1,t[l].e=.04,t[l].move(new shapeShift.Point({x:Math.random()*o.w,y:Math.random()*o.h,a:.3,r:4*Math.random(),h:0})))},render:function(){for(var e=0;e<t.length;e++)t[e].render()}}}();